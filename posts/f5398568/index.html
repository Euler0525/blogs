<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Nginx学习笔记 | 科海拾零</title><meta name="author" content="Euler0525"><meta name="copyright" content="Euler0525"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="运行环境 1234567OS: Ubuntu 24.04 nobleKernel: x86_64 Linux 6.8.0-90-genericShell: zsh 5.9Disk: 13G &#x2F; 68G (19%)CPU: AMD EPYC 7K62 48-Core @ 2x 2.595GHzGPU: Cirrus Logic GD 5446RAM: 804MiB &#x2F; 3915MiB 安装 1234">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx学习笔记">
<meta property="og:url" content="https://blog.euler0525.cn/posts/f5398568/index.html">
<meta property="og:site_name" content="科海拾零">
<meta property="og:description" content="运行环境 1234567OS: Ubuntu 24.04 nobleKernel: x86_64 Linux 6.8.0-90-genericShell: zsh 5.9Disk: 13G &#x2F; 68G (19%)CPU: AMD EPYC 7K62 48-Core @ 2x 2.595GHzGPU: Cirrus Logic GD 5446RAM: 804MiB &#x2F; 3915MiB 安装 1234">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://api.xsot.cn/bing?jump=true">
<meta property="article:published_time" content="2026-02-13T06:51:46.000Z">
<meta property="article:modified_time" content="2026-02-28T08:52:46.407Z">
<meta property="article:author" content="Euler0525">
<meta property="article:tag" content="前端">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://api.xsot.cn/bing?jump=true"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.euler0525.cn/posts/f5398568/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Nginx学习笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2026-02-28 16:52:46'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><meta name="generator" content="Hexo 7.0.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/atom.xml" title="科海拾零" type="application/atom+xml">
<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">61</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">118</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 页面</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-heart"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://api.xsot.cn/bing?jump=true')"><nav id="nav"><span id="blog-info"><a href="/" title="科海拾零"><span class="site-name">科海拾零</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 页面</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-heart"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Nginx学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2026-02-13T06:51:46.000Z" title="发表于 2026-02-13 14:51:46">2026-02-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-02-28T08:52:46.407Z" title="更新于 2026-02-28 16:52:46">2026-02-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C/">网络</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>8分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Nginx学习笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/posts/f5398568/#post-comment"><span class="gitalk-comment-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>运行环境</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">OS: Ubuntu 24.04 noble</span><br><span class="line">Kernel: x86_64 Linux 6.8.0-90-generic</span><br><span class="line">Shell: zsh 5.9</span><br><span class="line">Disk: 13G / 68G (19%)</span><br><span class="line">CPU: AMD EPYC 7K62 48-Core @ 2x 2.595GHz</span><br><span class="line">GPU: Cirrus Logic GD 5446</span><br><span class="line">RAM: 804MiB / 3915MiB</span><br></pre></td></tr></table></figure>
<h2 id="安装">安装</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/src</span><br><span class="line">wget https://nginx.org/download/nginx-1.29.5.tar.gz</span><br><span class="line">tar -zxvf nginx-1.29.5.tar.gz</span><br><span class="line">mv nginx-1.29.5 nginx</span><br><span class="line">cd nginx</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">ln -s /usr/local/nginx/sbin/nginx /usr/local/bin/  # 全局可执行</span><br></pre></td></tr></table></figure>
<p>配置文件位于 <code>/usr/local/nginx/conf/nginx.conf</code></p>
<h2 id="基本指令">基本指令</h2>
<ul>
<li>启动、停止和重新加载配置</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s &lt;signal&gt;</span><br></pre></td></tr></table></figure>
<p>其中 <code>signal</code> 包括</p>
<ul>
<li><code>stop</code> — 快速关闭</li>
<li><code>quit</code> — 优雅关闭，也可以使用
<code>kill -s QUIT &lt;PID&gt;</code> 指令关闭 Nginx 服务</li>
</ul>
<blockquote>
<p>主进程的 ID 号位于 <code>/usr/local/nginx/logs/nginx.pid</code></p>
</blockquote>
<ul>
<li><code>reload</code> —
重新加载配置文件：一旦主进程收到重新加载配置的信号，它会检查新配置文件的语法有效性并尝试应用其中提供的配置。如果成功，主进程将启动新的工作进程，并向旧的工作进程发送消息，请求它们关闭。否则，主进程将回滚更改，并继续使用旧配置。旧的工作进程收到关闭命令后，将停止接受新连接，并继续处理当前请求，直到所有此类请求都得到处理。之后，旧的工作进程退出。</li>
</ul>
<blockquote>
<p>重新加载配置后，错误日志位于
<code>/usr/local/nginx/logs/error.log</code></p>
</blockquote>
<ul>
<li><code>reopen</code> — 重新打开日志文件</li>
</ul>
<h2 id="基本配置">基本配置</h2>
<h3 id="静态服务">静态服务</h3>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="section">events</span> {</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> {</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> {</span><br><span class="line">        <span class="attribute">listen</span>  <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / {</span><br><span class="line">            <span class="attribute">root</span>   data/www;</span><br><span class="line">            <span class="attribute">index</span>  index.html;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span><span class="regexp"> ^~</span> /images/ {</span><br><span class="line">            <span class="attribute">root</span>  data;</span><br><span class="line">            <span class="attribute">index</span>  index.html;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="代理服务">代理服务</h3>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="section">events</span> {</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> {</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 用户访问的主入口，充当了反向代理服务器</span></span><br><span class="line">    <span class="section">server</span> {</span><br><span class="line">        <span class="attribute">listen</span>  <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 当用户访问根路径时，Nginx 会将请求透明地转发给本机 8080 端口处理。</span></span><br><span class="line">        <span class="section">location</span> / {</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://localhost:8080;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 以图片格式（gif/jpg/png）结尾的请求，Nginx 不会去请求 8080 端口，而是直接去服务器本地的 data 目录下查找文件并返回</span></span><br><span class="line">        <span class="section">location</span> <span class="regexp">~ \.(gif|jpg|png)$</span> {</span><br><span class="line">            <span class="attribute">root</span>  data;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 充当后端静态资源服务器</span></span><br><span class="line">    <span class="section">server</span> {</span><br><span class="line">        <span class="comment"># 监听 8080 端口，接收来自 80 端口转发过来的请求</span></span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line">        <span class="attribute">root</span> data/up1/www/;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / {</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h2 id="源代码解读">源代码解读</h2>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/nginx/nginx">nginx/nginx</a></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── core   # 基础库与基础框架</span><br><span class="line">├── event  # 事件模块</span><br><span class="line">├── http   # 实现 HTTP 具体协议</span><br><span class="line">├── mail</span><br><span class="line">├── misc</span><br><span class="line">├── os</span><br><span class="line">└── stream</span><br></pre></td></tr></table></figure>
<div class="mermaid-wrap"><pre class="mermaid-src" hidden="">
  graph LR
    subgraph core ["核心模块"]
        direction LR
        ngx_core ["ngx_core"]
        ngx_errlog ["ngx_errlog"]
        ngx_conf ["ngx_conf"]
        ngx_events ["ngx_events"]
        ngx_event ["ngx_event"]
        ngx_epoll ["ngx_epoll"]
        ngx_regex ["ngx_regex"]
    end

    subgraph modules [" "]
        direction LR
        subgraph third ["第三方模块"]
            direction TB
            Rds_json_nginx ["Rds-json-nginx"]
            Lua_nginx ["Lua-nginx"]
            Others4 ["Others"]
        end
        subgraph mail ["邮件服务模块"]
            direction TB
            Ngx_mail_core ["Ngx_mail_core"]
            Ngx_mail_pop3 ["Ngx_mail_pop3"]
            Others3 ["Others"]
        end
        subgraph http_opt ["可选 HTTP 模块"]
            direction TB
            Ngx_http_gzip ["Ngx_http_gzip"]
            Ngx_http_ssl ["Ngx_http_ssl"]
            Others2 ["Others"]
        end
        subgraph http_std ["标准 HTTP 模块"]
            direction TB
            Ngx_http_core ["Ngx_http_core"]
            Ngx_http_charset ["Ngx_http_charset"]
            Others1 ["Others"]
        end
    end

    core ~~~ modules
  </pre></div>
<center>
<small> Nginx 模块设计图 </small>
</center>
<h3 id="基础架构">基础架构</h3>
<h4 id="事件模型">事件模型</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 伪代码摘自 https://tengine.taobao.org/book/chapter_02.html</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) {</span><br><span class="line">    <span class="comment">// 1. 处理即时任务（Posted Events）</span></span><br><span class="line">    <span class="keyword">for</span> t in run_tasks:</span><br><span class="line">        t.handler();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 定时器管理（Timer Wheel）</span></span><br><span class="line">    update_time(&amp;now);</span><br><span class="line">    timeout = ETERNITY;</span><br><span class="line">    <span class="keyword">for</span> t in wait_tasks: <span class="comment">/* sorted already */</span></span><br><span class="line">        <span class="keyword">if</span> (t.time &lt;= now) {</span><br><span class="line">            t.timeout_handler();</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            timeout = t.time - now;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. I/O 多路复用（核心阻塞点）</span></span><br><span class="line">    nevents = poll_function(events, timeout);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 事件分发与任务转化</span></span><br><span class="line">    <span class="keyword">for</span> i in nevents:</span><br><span class="line">        task t;</span><br><span class="line">        <span class="keyword">if</span> (events[i].type == READ) {</span><br><span class="line">            t.handler = read_handler;</span><br><span class="line">        } <span class="keyword">else</span> { <span class="comment">/* events[i].type == WRITE */</span></span><br><span class="line">            t.handler = write_handler;</span><br><span class="line">        }</span><br><span class="line">        run_tasks_add(t);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>Worker 进程启动后，进入死循环，对应 <code>ngx_process_cycle</code>
中的事件循环部分。</p>
<ol type="1">
<li>首先处理即时任务，在执行 I/O
等待之前，先处理当前已经就绪的、不需要等待的 I/O 任务，对应 Nginx
的投递事件 <code>Posted Events</code>；</li>
<li>定时器管理：检查是否有超时任务需要执行，并计算下一次 I/O
等待的最长时间，对应 Nginx 中的定时器队列
<code>Timer Queue</code>；</li>
<li>I/O 多路复用：调用操作系统内核提供的 I/O
多路复用接口，等待事件发生，对应 Linux 的
<code>epoll_wait()</code>；Work 进程在这里进入睡眠状态，不占用
CPU。<strong>网络 I/O 事件发生</strong> 或 <strong>定时器超时</strong>
被 <strong>唤醒</strong>；</li>
<li>事件分发与任务转化：将内核通知的 I/O
事件，转化为应用层的可执行任务，放入下一轮的 <code>run_tasks</code>
队列，对应 Nginx 的事件回调注册
<code>Event Callback Registration</code>；遍历所有就绪的事件，判断可读或可写类型，构造对应的处理函数，然后加到队列中，下一轮循环开始时执行；</li>
</ol>
<h4 id="事件循环">事件循环</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 伪代码摘自 https://tengine.taobao.org/book/chapter_02.html</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 背压机制, 当连接池快用完时, 暂停接受新连接, 优先处理现有请求</span></span><br><span class="line">ngx_accept_disabled = ngx_cycle-&gt;connection_n / <span class="number">8</span> - ngx_cycle-&gt;free_connection_n;</span><br><span class="line"></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">// ngx_event.c ngx_process_events_and_timers</span></span><br><span class="line"><span class="keyword">if</span> (ngx_accept_disabled &gt; <span class="number">0</span>) {</span><br><span class="line">    ngx_accept_disabled--;</span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">    <span class="comment">// Accept 锁解决惊群效应, 多个 Worker 进程同时抢接受新连接, 最终只有一个成功, 导致 CPU 浪费</span></span><br><span class="line">    <span class="keyword">if</span> (ngx_trylock_accept_mutex(cycle) == NGX_ERROR) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ngx_accept_mutex_held) {</span><br><span class="line">        flags |= NGX_POST_EVENTS;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">// 定时器调整, 实现负载均衡与公平性</span></span><br><span class="line">        <span class="keyword">if</span> (timer == NGX_TIMER_INFINITE || timer &gt; ngx_accept_mutex_delay) {</span><br><span class="line">            timer = ngx_accept_mutex_delay;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>这段程序的主要作用是
<strong>控制新连接的接受速率</strong>、<strong>协调多 Worker
进程间的负载均衡</strong>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Nginx Worker 事件循环</span><br><span class="line">│</span><br><span class="line">├── 1. 检查连接池水位 (ngx_accept_disabled)</span><br><span class="line">│   ├── 空闲连接 &lt; 12.5% ? ──&gt; 暂停 accept (背压)</span><br><span class="line">│   └── 空闲连接充足 ──&gt; 继续</span><br><span class="line">│</span><br><span class="line">├── 2. 竞争 Accept 锁 (ngx_trylock_accept_mutex)</span><br><span class="line">│   ├── 抢到锁 ? ──&gt; 标记 NGX_POST_EVENTS (延迟 accept)</span><br><span class="line">│   └── 没抢到 ? ──&gt; 本次循环只处理 I/O，不接受新连接</span><br><span class="line">│</span><br><span class="line">├── 3. 调整 epoll_wait 超时 (timer)</span><br><span class="line">│   ├── 没抢到锁 ? ──&gt; 强制 timer = 500ms (快速醒来再抢)</span><br><span class="line">│   └── 抢到锁 ? ──&gt; 使用正常 timer</span><br><span class="line">│</span><br><span class="line">├── 4. 调用 epoll_wait(timer)</span><br><span class="line">│   └── 等待 I/O 事件或超时唤醒</span><br><span class="line">│</span><br><span class="line">└── 5. 处理事件 (I/O 或 Posted Accept)</span><br></pre></td></tr></table></figure>
<p><code>ngx_cycle-&gt;connection_n</code>
表示启动时预分配的连接池总大小，<code>ngx_cycle-&gt;free_connection_n</code>
表示空闲的可用连接数，如果空闲数超过总数的 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -1.602ex;" xmlns="http://www.w3.org/2000/svg" width="2.127ex" height="4.638ex" role="img" focusable="false" viewBox="0 -1342 940 2050"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mstyle"><g data-mml-node="mfrac"><g data-mml-node="mn" transform="translate(220,676)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mn" transform="translate(220,-686)"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g><rect width="700" height="60" x="120" y="220"></rect></g></g></g></g></svg></mjx-container></span>，正常接受新连接，否则暂停接受新连接，并且持续暂停多次循环，留给
Nginx 足够时间处理积压的请求；</p>
<hr>
<p><code>ngx_trylock_accept_mutex</code> 尝试获得一个全局锁，成功则
<code>ngx_trylock_accept_mutex</code> 为 1，当前 Worker
获得唯一接受新连接的权限，否则放弃本次机会，只处理已有连接的
I/O；如果拿到锁，设置 <code>NGX_POST_EVENTS</code>
标志，通知事件处理模块将 <code>accept</code>
放入延迟队列，等处理完已经就绪的 I/O
事件后，在接受新连接；确保同一时刻只有一个 Worker 进程调用
<code>accept()</code>，避免多进程竞争，减少上下文切换和系统调用开销。</p>
<blockquote>
<p>优先处理当前已经就绪的 I/O 事件（如读取已建立连接的数据），处理完后再
<code>accept</code>
新连接。这有助于更快释放连接资源，配合上面的背压机制。</p>
</blockquote>
<hr>
<p>一个 Worker 没有拿到锁，它不会接受新连接，如果它进入
<code>epoll_wait</code> 并且休眠很久，其实其它拿到锁的 Worker
处理完了，自己还在休眠，无法竞争下一轮锁，这会导致负载不均，于是程序重新配置定时器，强制唤醒，超过
<code>ngx_accept_mutex_delay</code> 时间后再次尝试
<code>ngx_trylock_accept_mutex</code>，通过限制最大休眠时间，确保所有
Worker 都能有机会频繁地竞争锁，均匀分担新连接的压力。</p>
<h3 id="数据结构">数据结构</h3>
<blockquote>
<p>Nginx 实现了一些自定义的数据结构并提供 API，核心思路包括：</p>
<ul>
<li><strong>内存池化</strong>：避免碎片，简化生命周期管理；</li>
<li><strong>嵌入式设计</strong>：队列、树节点嵌入业务结构，避免额外指针跳转；</li>
<li><strong>零拷贝</strong>：Buffer 设计支持直接发送文件描述符；</li>
<li><strong>空间换时间</strong>：哈希表预计算，数组连续内存，最大化 CPU
缓存命中率；</li>
</ul>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ngx_cycle_t (全局)</span><br><span class="line">  │</span><br><span class="line">  ├─ ngx_pool_t (全局池)</span><br><span class="line">  │</span><br><span class="line">  └─ ngx_connection_t[] (连接数组)</span><br><span class="line">       │</span><br><span class="line">       └─ ngx_http_request_t (请求对象，每个连接一个)</span><br><span class="line">            │</span><br><span class="line">            ├─ pool: ngx_pool_t* (请求池)</span><br><span class="line">            ├─ uri: ngx_str_t (请求 URI)</span><br><span class="line">            ├─ headers_in: ngx_list_t (请求头链表)</span><br><span class="line">            ├─ out: ngx_chain_t* (响应输出链)</span><br><span class="line">            │      ├─ buf: ngx_buf_t (响应头)</span><br><span class="line">            │      └─ next → buf: ngx_buf_t (响应体)</span><br><span class="line">            └─ timer: ngx_rbtree_node_t (嵌入红黑树节点)</span><br></pre></td></tr></table></figure>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://github.com/nginx/nginx/blob/master/src/core/ngx_string.h">内存池
<code>ngx_pool_t</code></a>：每个 HTTP 请求
<code>ngx_http_request_t</code> 都有一个
<code>pool</code>，请求过程中产生的临时变量都从 <code>pool</code>
分配，请求结束 <code>ngx_destroy_pool</code> 清理；</p></li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/nginx/nginx/blob/master/src/core/ngx_string.h">字符串
<code>ngx_str_t</code></a>：显式记录字符串长度；</p></li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/nginx/nginx/blob/master/src/core/ngx_array.h">动态数组
<code>ngx_array_t</code></a>：从 <code>pool</code>
中分配，无需手动释放；地址连续，CPU 缓存友好；</p></li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/nginx/nginx/blob/master/src/core/ngx_list.h">链表
<code>ngx_list_t</code></a>：数组的链表，分段连续。用于存储数量不确定、需要频繁追加的元素，例如请求头宇响应头（数量不确定且需要逐个解析）；</p></li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/nginx/nginx/blob/master/src/core/ngx_queue.h">队列
<code>ngx_queue_t</code></a>：嵌入式双向链表，只包含指针；</p></li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/nginx/nginx/blob/master/src/core/ngx_buf.h">缓冲区
<code>ngx_buf_t, ngx_chain_t</code></a>：实现零拷贝和过滤器链；</p></li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/nginx/nginx/blob/master/src/core/ngx_rbtree.h">红黑树
<code>ngx_rbtree_t</code></a>：用于查找和排序，例如定时器、DNS
缓存；</p></li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/nginx/nginx/blob/master/src/core/ngx_hash.h">哈希表
<code>ngx_hash_t</code></a></p></li>
</ul>
<table>
<colgroup>
<col style="width: 22%">
<col style="width: 20%">
<col style="width: 57%">
</colgroup>
<thead>
<tr>
<th style="text-align: center;">数据结构</th>
<th style="text-align: center;">对应标准库</th>
<th style="text-align: center;">Nginx 优化</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>ngx_pool_t</code></td>
<td style="text-align: center;"><code>malloc/free</code></td>
<td style="text-align: center;"><strong>防泄漏</strong>、减少系统调用、批量释放</td>
</tr>
<tr>
<td style="text-align: center;"><code>ngx_str_t</code></td>
<td style="text-align: center;"><code>char*</code></td>
<td style="text-align: center;"><strong>O(1)
长度</strong>、二进制安全</td>
</tr>
<tr>
<td style="text-align: center;"><code>ngx_array_t</code></td>
<td style="text-align: center;"><code>std::vector</code></td>
<td style="text-align: center;"><strong>基于
Pool</strong>、连续内存、缓存友好</td>
</tr>
<tr>
<td style="text-align: center;"><code>ngx_list_t</code></td>
<td style="text-align: center;"><code>std::list</code></td>
<td style="text-align: center;"><strong>分段连续</strong>、兼顾灵活性与性能</td>
</tr>
<tr>
<td style="text-align: center;"><code>ngx_queue_t</code></td>
<td style="text-align: center;">双向链表</td>
<td style="text-align: center;"><strong>嵌入式</strong>、可反推结构体、通用性强</td>
</tr>
<tr>
<td style="text-align: center;"><code>ngx_buf_t</code></td>
<td style="text-align: center;">Buffer</td>
<td style="text-align: center;"><strong>零拷贝支持</strong>
(<code>in_file</code>)、散聚 I/O</td>
</tr>
<tr>
<td style="text-align: center;"><code>ngx_rbtree_t</code></td>
<td style="text-align: center;"><code>std::map</code></td>
<td style="text-align: center;"><strong>嵌入式</strong>、定时器专用优化</td>
</tr>
<tr>
<td style="text-align: center;"><code>ngx_hash_t</code></td>
<td style="text-align: center;"><code>HashMap</code></td>
<td style="text-align: center;"><strong>静态预计算</strong>、查找速度极致优化</td>
</tr>
</tbody>
</table>
<h2 id="参考资料">参考资料</h2>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://nginx.ac.cn/en/docs/index.html">Nginx
文档</a></p></li>
<li><p><a target="_blank" rel="noopener" href="https://nginx.mosong.cc/">Nginx 教程</a></p></li>
<li><p><a target="_blank" rel="noopener" href="https://tengine.taobao.org/book/">Nginx
开发从入门到精通</a></p></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.euler0525.cn">Euler0525</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.euler0525.cn/posts/f5398568/">https://blog.euler0525.cn/posts/f5398568/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.euler0525.cn" target="_blank">科海拾零</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a></div><div class="post_share"><div class="social-share" data-image="https://api.xsot.cn/bing?jump=true" data-sites="wechat, qq, weibo"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/39c87a76/" title="链路预算"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.xsot.cn/bing?jump=true" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">链路预算</div></div></a></div><div class="next-post pull-right"><a href="/posts/41e39f2b/" title="内存管理"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.xsot.cn/bing?jump=true" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">内存管理</div></div></a></div></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4"><span class="toc-number">2.</span> <span class="toc-text">基本指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-number">3.</span> <span class="toc-text">基本配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.1.</span> <span class="toc-text">静态服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.2.</span> <span class="toc-text">代理服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BA%90%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB"><span class="toc-number">4.</span> <span class="toc-text">源代码解读</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84"><span class="toc-number">4.1.</span> <span class="toc-text">基础架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E6%A8%A1%E5%9E%8B"><span class="toc-number">4.1.1.</span> <span class="toc-text">事件模型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF"><span class="toc-number">4.1.2.</span> <span class="toc-text">事件循环</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">4.2.</span> <span class="toc-text">数据结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">5.</span> <span class="toc-text">参考资料</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2026 By Euler0525</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const initGitalk = () => {
    const gitalk = new Gitalk(Object.assign({
      clientID: 'Ov23lioMo7LF5urlkKZI',
      clientSecret: 'dceac52a81d3a5702ab3eeeb3763babe336d27ae',
      repo: 'blogs',
      owner: 'Euler0525',
      admin: ['Euler0525'],
      id: '640b7c6295769199046e1395f256947c',
      updateCountCallback: commentCount
    },))

    gitalk.render('gitalk-container')
  }

  const loadGitalk = async() => {
    if (typeof Gitalk === 'function') initGitalk()
    else {
      await getCSS('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css')
      await getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js')
      initGitalk()
    }
  }
  
  const commentCount = n => {
    const isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
    if (isCommentCount) {
      isCommentCount.textContent= n
    }
  }

  if ('Gitalk' === 'Gitalk' || !false) {
    if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
    else loadGitalk()
  } else {
    window.loadOtherComment = loadGitalk
  }
})()</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>