---
title: 从复数到四元数
tags:
  - 四元数
  - 阵列信号处理
categories: 信号处理
mathjax: true
abbrlink: '8e775828'
date: 2025-09-11 11:38:25
---

## 复数与二维旋转

设复数 $z_1 = a_1+b_1i,\ z_2 = a_2+b_2i$，则

$$
z_1z_2 = (a_1a_2 - b_1b_2) + (a_1b_2 + a_2b_1)i
$$


将这个结果写成矩阵相乘的形式，

$$
z_1z_2 = \begin{bmatrix}
a_1 & -b_1\\
b_1 & a_1\\
\end{bmatrix}
\begin{bmatrix}
a_2\\b_2\\
\end{bmatrix}
$$

说明 **矩阵 $R_1 =  \begin{bmatrix}a_1 & -b_1\\ b_1 & a_1\\ \end{bmatrix}$ 表示的几何变换与是复数乘法运算等价的**。

一般地，向量 $\begin{bmatrix}a\\b \end{bmatrix}$ 在二维平面中对应一个直角三角形，两个直角边长度为 $a$ 和 $b$，斜边长为 $\sqrt{a^2+b^2}$，即向量的模长，矩阵 $R =  \begin{bmatrix}a & -b\\ b & a\\ \end{bmatrix}$ 的每个元素同时除以模长，得到

$$
R = \begin{bmatrix}
\dfrac{a}{\sqrt{a^2+b^2}} & -\dfrac{b}{\sqrt{a^2+b^2}} \\
\dfrac{b}{\sqrt{a^2+b^2}} & \dfrac{a}{\sqrt{a^2+b^2}} \\
\end{bmatrix}
$$

设向量 $\begin{bmatrix}a\\b \end{bmatrix}$ 与 $x$ 轴夹角为 $\theta$，则 $\cos\theta = \dfrac{a}{\sqrt{a^2+b^2}},\ \sin\theta = \dfrac{b}{\sqrt{a^2+b^2}}$.

$$
R = \begin{bmatrix}
\cos\theta & -\sin\theta\\
\sin\theta & \cos\theta\\
\end{bmatrix}
$$

与该矩阵相乘在二维平面上实现的效果是 **被乘的向量绕原点逆时针旋转 $\theta$**.

由此可以发现，复数能够表示二维平面上的旋转，假设旋转角度为 $\theta$，定义单位复数旋转因子为

$$
q = \cos\theta + i\sin\theta
$$


被旋转的向量 $z = a + ib$，相乘得到被旋转 $\theta$ 后的复数为


$$
\begin{aligned}
z' = qz &= (\cos\theta + i\sin\theta)(a + ib)\\
&= (a\cos\theta - b\sin\theta) + i(a\sin\theta + b\cos\theta)\\
\end{aligned}
$$

对应向量 $[a,b]$ 在二维平面 $x0y$ 中绕原点逆时针旋转了 $\theta$.

## 四元数与三维旋转

> 本文仅使用右手坐标系。

在三维空间中，向量 $\mathbf{v}$ 绕某个旋转轴 $\mathbf{u},\ |\mathbf{u}|^2=1$ 旋转，可以将向量 $\mathbf{v}$ 分解为平行于 $\mathbf{u}$ 的分量 $\mathbf{v}_{\parallel}$ 和垂直于 $\mathbf{u}$ 的分量 $\mathbf{v}_\perp$，然后分别旋转这两个向量，再合并得到最后结果。

其中

$$
\begin{aligned}
\mathbf{v}_{\parallel} &= \dfrac{\mathbf{u}\cdot \mathbf{v}}{|\mathbf{u}|^2} \mathbf{u} = (\mathbf{u}\cdot \mathbf{v}) \mathbf{u}\\
\mathbf{v}_{\perp} &= \mathbf{v} - \mathbf{v}_{\parallel} = \mathbf{v} - (\mathbf{u}\cdot \mathbf{v}) \mathbf{u}\\
\end{aligned}
$$

$\mathbf{v}_{\parallel}$ 始终与 $\mathbf{u}$ 重合，旋转 $\theta$ 后的 $\mathbf{v}_{\parallel}' = \mathbf{v}_{\parallel} = (\mathbf{u}\cdot \mathbf{v}) \mathbf{u}$ ；

$\mathbf{v}_{\perp}$ 始终与 $\mathbf{u}$ 垂直，它的旋转可以看作二维平面内的旋转，如下图所示，

<img src="https://cdn.jsdelivr.net/gh/Euler0525/tube@master/math/3d_quaternion.webp" width="60%" />

$$
\left\{
\begin{aligned}
\mathbf{w} &= \mathbf{u}\times \mathbf{v}_{\perp}\\
\mathbf{v}_{\perp}' &= \mathbf{v}_{v}' + \mathbf{v}_{w}'\\
&= \mathbf{v}_{\perp}\cos\theta + \mathbf{w}\sin\theta\\
&= \mathbf{v}_{\perp}\cos\theta + (\mathbf{u}\times \mathbf{v}_{\perp})\sin\theta\\
&= \mathbf{v}_{\perp}\cos\theta + (\mathbf{u}\times (\mathbf{v} - \mathbf{v}_{\parallel}))\sin\theta\\
&= \mathbf{v}_{\perp}\cos\theta + (\mathbf{u}\times \mathbf{v})\sin\theta\\
\end{aligned}
\right.
$$

向量 $\mathbf{v}$ 绕旋转轴 $\mathbf{u}$， 旋转的结果

$$
\begin{aligned}
\mathbf{v}' &= \mathbf{v}_{\perp}' + \mathbf{v}_{\parallel}'\\
&= \mathbf{v}_{\perp}\cos\theta + (\mathbf{u}\times \mathbf{v})\sin\theta + (\mathbf{u}\cdot \mathbf{v}) \mathbf{u}\\
&= \mathbf{v}\cos\theta + (1-\cos\theta)(\mathbf{u}\cdot\mathbf{v})\mathbf{u} + (\mathbf{u}\times \mathbf{v})\sin\theta\\
\end{aligned}
$$

---

为了用“复数”形式表示类似的旋转，最简单的想法是在复数域再加一个维度，即在复数的基础上增加一个虚数 $j$，假设三维空间中的“复数”为

$$
\begin{aligned}
q_1 &= a_1 + b_1i + c_1j\\
q_2 &= a_2 + b_2i + c_2j\\
\end{aligned}
$$

显然，$q_1$ 与 $q_2$ 相乘得到的结果中包含 $ij,ji$ 这些交叉乘积项，并没有已知定义（与 $q_1, q_2$ 不在同一个向量空间中），因此不能表示三维空间中旋转的结果。

> 在二维平面中，向量可以在 $x0y$ 平面旋转，只需要一个虚数，而在三维空间中，向量旋转等效于在 $x0y,x0z,y0z$ 三个平面旋转，或许需要三个虚数表示才可以。

于是定义四元数，表示为 $q=[s,\mathbf{v}],\ s\in R, \mathbf{v}\in \mathbb{R}^3$，

$$
q = s + xi  + yj + zk
$$

其中 $i,j,k$ 表示三个维度，并且根据笛卡尔坐标系下的外积运算法则，定义

$$
\begin{aligned}
&ij = k, jk = i, ki = j\\
&ji =-k, kj =-i, ik =-j\\
&i^2 = j^2 = k^2 = ijk =-1\\
\end{aligned}
$$

<img src="https://upload.wikimedia.org/wikipedia/commons/a/a2/William_Rowan_Hamilton_Plaque_-_geograph.org.uk_-_347941.jpg" width="60%" />

<center> <small> 金雀花桥上的纪念石刻（图片来源于网络）</small> </center>

---

定义两个四元数

$$
\begin{aligned}
q_1 &= s_1 + x_1i + y_1j + z_1k\\
q_2 &= s_2 + x_2i + y_2j + z_2k\\
\end{aligned}
$$

令 $a = x_1i+y_1j+z_1k,\ b = x_2i+y_2j+z_2k$，相乘并化简得到

$$
\begin{aligned}
q_1q_2 &= (s_1 + x_1i + y_1j + z_1k)(s_2 + x_2i + y_2j + z_2k)\\
&= (s_1s_2 - x_1x_2 - y_1y_2 - z_1z_2) \\
&+ (s_1x_2 + s_2x_1 + y_1z_2 - y_2z_1)i \\
&+ (s_1y_2 + s_2y_1 - x_1z_2 + x_2z_1)j \\
&+ (s_1z_2 + s_2z_1 + x_1y_2 - x_2y_1)k\\
\end{aligned}
$$

其中

$$
s_1s_2 - x_1x_2 - y_1y_2 - z_1z_2 = s_1s_2 - a\cdot b
$$

其余部分将 $s_1,s_2$ 提出，得到

$$
\begin{aligned}
\cdots &= s_1(x_2i+y_2j+z_2k) + s_2(x_1i+y_1j+z_1k)\\
&+(y_1z_2 - y_2z_1)i + (z_1x_2-z_2x_1)j + (x_1y_2 -x_2y_1)k\\
&= s_1b+s_2a + a\times b\\
\end{aligned}
$$

最后得到两个四元数相乘的结果为

$$
q_1q_2 = [s_1s_2 - a\cdot b, s_1b+s_2a+a\times b]\\
$$

也可以将相乘结果写成

$$
\begin{aligned}
q_1q_2 &= (s_1 + x_1i + y_1j + z_1k)(s_2 + x_2i + y_2j + z_2k)\\
&= (s_1s_2 - x_1x_2 - y_1y_2 - z_1z_2) \\
&+ ( x_1s_2 + s_1x_2 - z_1y_2 + y_1z_2)i \\
&+ (y_1s_2 + z_1x_2 + s_1y_2 - x_1z_2 )j \\
&+ (z_1s_2 - y_1x_2 + x_1y_2 + s_1z_2)k \\
\end{aligned}
$$


该乘法结果可以表示成矩阵形式

$$
\begin{bmatrix}
s_1 & -x_1 & -y_1 & -z_1\\
x_1 & s_1 & -z_1 & y_1\\
y_1 & z_1 & s_1 & -x_1\\
z_1 & -y_1 & x_1 & s_1\\
\end{bmatrix}
\begin{bmatrix}
s_2\\x_2\\y_2\\z_2\\
\end{bmatrix}
$$


与矩阵类似，四元数的乘法并不遵循交换律。类比矩阵的逆的定义，定义四元数乘法的逆运算为 $q^{-1}$，满足


$$
qq^{-1} = q^{-1}q = 1,\ q\not = 0
$$

与复数的共轭类似，定义四元数 $q=s+xi+yj+zk$ 的共轭为

$$
q^* = s-xi-yj-zk
$$

满足

$$
\begin{aligned}
qq^* &= s^2 + \mathbf{v}\cdot \mathbf{v}\\
&= s^2 + x^2 + y^2 + z^2\\
&= ||q||^2\\
\end{aligned}
$$

则有

$$
\begin{aligned}
qq^{-1} &= 1\\
q^*qq^{-1} &= q^*\\
||q||^2q^{-1} &= q^*\\
q^{-1} &= \dfrac{q^*}{||q||^2}\\
\end{aligned}
$$

并且对于单位四元数来说，$q^{-1}=q^*$.

---

回到最初讨论的三维空间中的旋转问题，令 $s_1=0, q_1=x_1i+y_1j+z_1k$，$q_1$ 表示三维空间的向量，相乘结果为

$$
q_1q_2 = [- a\cdot b, s_2a + a\times b]\\
$$

为了使得旋转后的结果仍为三维向量，需要满足 $-a\cdot b=0$，即 $a\perp b$.

---

> 只有虚部的四元数称为纯四元数，表示为 $[0, \mathbf{v}]$，两个纯四元数的乘积为
>
> $$
> v_1v_2 = [0 - \mathbf{v}_1\cdot \mathbf{v}_2, 0 + v_1\times v_2] = [-\mathbf{v}_1\cdot \mathbf{v}_2, v_1\times v_2]
> $$

基于前文向量 $\mathbf{v}$ 绕旋转轴 $\mathbf{u}$ 的讨论，将向量均用纯四元数表示

$$
\begin{aligned}
&v = [0, \mathbf{v}],\ v' = [0, \mathbf{v}']\\
&v_{\perp} = [0, \mathbf{v}_{\perp}],\ v_{\perp}' = [0, \mathbf{v}_{\perp}']\\
&v_{\parallel} = [0, \mathbf{v}_{\parallel}],\ v_{\parallel}' = [0, \mathbf{v}_{\parallel}']\\
&u = [0, \mathbf{u}]\\
\end{aligned}
$$

向量 $\mathbf{v}_{\parallel}$ 旋转后的结果

$$
\mathbf{v}_{\parallel}' = \mathbf{v}_{\parallel}
$$


向量 $\mathbf{v}_{\perp}$ 旋转后的结果

$$
\mathbf{v}_{\perp}' = \mathbf{v}_{\perp}\cos\theta + (\mathbf{u}\times \mathbf{v}_{\perp})\sin\theta\\
$$

已知 $uv_{\perp} = [-\mathbf{u}\cdot \mathbf{v}_{\perp}, \mathbf{u}\times \mathbf{v}_{\perp}] = [0, \mathbf{u}\times \mathbf{v}_{\perp}]$，则


$$
\begin{aligned}
\mathbf{v}_{\perp}' &= v_{\perp}\cos\theta + (uv_{\perp})\sin\theta\\
&= (\cos\theta + \sin\theta u)v_{\perp}\\
\end{aligned}
$$

由此可以得出，完成旋转 $\theta$ 这一变换的单位四元数可以构造为

$$
q = \cos\theta + \sin\theta u = [\cos\theta, \sin\theta u_x i + \sin\theta u_y j + \sin\theta u_z k], \  |q| = 1
$$

单位向量 $\mathbf{u}$ 指向转轴方向，待转向量 $\mathbf{v}_{\perp}$ 正交于 $\mathbf{u}$ 时，将旋转变换用四元数形式改写为

$$
v_{\perp}' = qv_{\perp}
$$

---

一般地，

$$
v' = \mathbf{v}_{\parallel}' + \mathbf{v}_{\perp}' = \mathbf{v}_{\parallel} + q\mathbf{v}_{\perp}
$$

令 $p = [\cos\dfrac{1}{2}\theta, \sin\dfrac{1}{2}\theta u], \ |p|=1$，则


$$
\begin{aligned}
v' &= pp^{-1}\mathbf{v}_{\parallel} + pp\mathbf{v}_{\perp}\\
&= pp^{*}\mathbf{v}_{\parallel} + pp\mathbf{v}_{\perp}\\
&= p\mathbf{v}_{\parallel}p^{*} + p\mathbf{v}_{\perp}p*\\
&= pvp*\\
\end{aligned}
$$

最终得出结论，任意向量 $\mathbf{v}$ 绕指向转轴方向的单位向量 $\mathbf{u}$ 旋转 $\theta$，旋转后的 $v'$ 可以用下面运算得到

$$
v' = qvq^* = qvq^{-1}\\
$$

其中 $v = [0, \mathbf{v}], q = [\cos\dfrac{1}{2}\theta, \sin\dfrac{1}{2}\theta \mathbf{u}], \ |q|=1$.

---

在表示二维平面中的旋转时，利用欧拉公式可以将旋转表示为指数形式 $z'=e^{i\theta}z$，类似地，对于单位四元数 $u=[0, \mathbf{u}]$，有

$$
e^{u\theta} = \cos\theta + u\sin\theta\\
$$

于是前面四元数的旋转表达式可以写成

$$
v' = qvq^* = qvq^{-1} = e^{u\frac{\theta}{2}} v e^{-u\frac{\theta}{2}}
$$

> 考察四元数 $-q$ 的变换，
>
> $$
> \begin{aligned}
> -q &= [-\cos\dfrac{1}{2}\theta, -\sin\dfrac{1}{2}\theta\mathbf{u}]\\
>  &= [\cos(\pi - \dfrac{1}{2}\theta), \sin(\pi - \dfrac{1}{2}\theta) (-\mathbf{u})]\\
> v' &= (-q)v(-q)^* = (-1)^2qvq^* = qvq^*\\
> \end{aligned}
> $$
>
> 与 $q$ 的变换相同。从几何角度考虑，$q$ 表示绕转轴旋转 $\theta$，而 $-q$ 表示绕相反的转轴旋转 $2\pi-\theta$，所以说 **单位四元数与三维旋转是一个二对一的满射同态关系**。

## 四元数插值与三维旋转

> 前置知识：[线性插值](https://zh.wikipedia.org/zh-cn/%E7%BA%BF%E6%80%A7%E6%8F%92%E5%80%BC)
>
> 已知函数 $f(x)$ 在两点的值，要获得其它点数值，
>
> $$
> f(x) = f(x_0) + \dfrac{f(x_1)-f(x_0)}{x_1-x_0}(x-x_0)
> $$

与函数的线性插值类似，下面讨论四元数的插值，用单位四元数 $q_1$ 表示第一个方向，$q_2$ 表示第二个方向，$q$ 表示最终的方向。

与线性插值类似，当插值参数 $t=0$ 时，插值的效果是将 $q$ 旋转到 $q_1$，当 $t=1$ 时，插值的效果是将 $q$ 旋转到 $q_2$。

> 旋转的对象是角度，从指数形式 $e^{u\theta}$ 考虑，“线性插值”的对象是四元数的指数，类比写出四元数插值的形式
>
> $$
> q = q_1(\Delta q)^t\\
> $$

其中 $q_1$ 与 $q_2$ 的角度差 $\Delta q = q_1^{-1}q_2$，即

$$
q = q_1(q_1^{-1}q_2)^t\\
$$

当插值系数 $t=0$ 时，$q=q_1$，当 $t=1$ 时，$q=q_2$。



*注：四元数不止有一种定义形式，本文仅涉及 Hamilton 形式。*

## 参考资料

[张小飞, 李建峰, 徐大专, 等.阵列信号处理及 MATLAB 实现[M].电子工业出版社,2020.（2.3 四元数理论）](https://www.kdocs.cn/l/cbkVHUxZbOj1)

[Krasjet/quaternion](https://github.com/Krasjet/quaternion)

[从复数乘法到旋转矩阵 - YourMath](https://mp.weixin.qq.com/s/HXpydM6vNJoDdcWv5OW-TA)
